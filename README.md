# eugenebbr_microservices
eugenebbr microservices repository

***Домашнее задание N14***
***Технология контейнеризации. Введение в Docker***

В ходе выполнения домашнего задания был установлен Docker, запущен тестовый контейнер hello-world.
Были протестированы различные команды, также был создан образ и контейнера и выполнены команды inspect на образе и на контейнере. Результаты сравнения записаны в файл docker-monolith/docker-1.log.
Был создан новый проект в GCP и поднят докер-хост.
Создан Dockerfile нашего приложения, затем из него создан образ и запущен контейнер в GCP.
После тестирования образ был загружен в Docker Hub.

В ходе выполнения домашнего задания со (*) было реализовано:

1. Поднятие инстансов через terraform
2. Установка на них докера и образ нашего приложения через плейбуки Ansible
3. Шаблон пакера, создающий образ с установленным докером


***Домашнее задание N15***
***Docker-образы. Микросервисы.***

В ходе выполнения домашнего задания мы разделили наше приложение на три компоненты: сервис отвечающий за комментарии, сервис отвечающий за посты и веб-интерфейс приложения.
Для каждого из сервисов собрали докер-образ, создали сеть для взаимодействия контейнеров и сетевыве алиасы контейнерам.
В задаче со (*) задали новые алиасы через переменные окружения, чтобы не пересоздавать образ.
Мы улучшили наши образы, выбрав в качестве основного образа Alpine Linux, а также уменьшив количество слоев.
После этого проверили сохранение данных в БД, создав volume и подключив его к нужному контейнеру.

***Домашнее задание N16***
***Docker: сети, docker-compose***

В ходе домашнего задания мы запустили контейнер с использованием none-драйвера, в сетевом пространстве docker-хоста.
Запустили несколько раз команду:

```
docker run --network host -d nginx
```

Запустился только один докер-контейнер, так как нельзя в сетевом пространстве хоста иметь несколько контейнеров, слушающих один и тот же порт.

Посмотрели как меняется список namespace'ов с использованием драйверов none и host - host-драйвер не создает новый namespace, в отличие от none-драйвера.

Создали bridge-сеть и проверили работу сетевых алиасов, создали отдельные сети для докер-контейнеров, посмотрели какие правила создает iptables на докер хосте для работы наших контейнеров

Установили docker-compose, описали запуск наших контейнеров в нем, создание подсетей, параметризовали часть ресурсов для контейнеров и записали переменные в файл .env.

По-умолчанию docker-compose создает префикс ко всем сущностям, исходя из названия папки, откуда запускается. Это можно изменить несколькими способами:

```
docker-compose -p PROJECT_NAME
```

Добавить переменную окружения COMPOSE_PROJECT_NAME

В ходе выполнения задачи со (*) был создан файл docker-compose.override.yml
В него было добавлено монтирование локальных папок приложений в соответствующие контейнеры и запуск приложения с параметрами дебага и двумя воркерами.
Работает docker-compose.override.yml в локальной среде. С использование mount на удаленном docker-host поднимался только контейнер с БД.

***Домашнее задание N17***
***Устройство Gitlab CI. Построение процесса непрерывной поставки***

В ходе выполнения домашнего задания была создана ВМ для построения процесса CI (с помощью terraform), был установлен Docker (с помощью Ansible), поднят контейнер с Gitlab CI.
В Gitlab CI был создан учебный проект и тестовый pipeline.
После этого был создан runner для запуска заданий нашего pipeline.
Был добавлен код приложения reddit, в pipeline были описаны stage для сборки, тестирования и деплоя приложения.
Добавлены два окружения в наш проект, а также настроены динамические окружения.

В шаг build была добавлена сборка контейнера с нашим приложением и отправкой его на dockerhub.
В шаге deploy был добавлен деплой нашего контейнера на созданный для этого сервер и проверена доступность по 9292 порту.
Реализован функционал автоматического добавления Gitlab CI Runner. Для этого был использован Ansible и community-роль "riemers.gitlabrunner".
Настроена интеграция pipeline с тестовым slack-чатом, ссылка на канал для проверки: https://devops-team-otus.slack.com/archives/CUVQNH3K4

(#evgeny_bratchenko)
